import{_ as o,r as a,o as r,c as s,a as n,b as e}from"./app.c9d8ac17.js";var i="/blog/assets/failed-google-trends-chart.d0900e88.png",l="/blog/assets/google-search.66ad8b53.png";const k='{"title":"March 2021 update","description":"Migration of API endpoints to Cloudflare workers, more sophisticated cache management, Google Trends chart fixes and more...","frontmatter":{"title":"March 2021 update","date":"2021-03-08T00:00:00.000Z","summary":"Migration of API endpoints to Cloudflare workers, more sophisticated cache management, Google Trends chart fixes and more...","head":[["meta",{"name":"description","content":"Migration of API endpoints to Cloudflare workers, more sophisticated cache management, Google Trends chart fixes and more..."}],["meta",{"property":"og:description","content":"Migration of API endpoints to Cloudflare workers, more sophisticated cache management, Google Trends chart fixes and more..."}],["meta",{"name":"twitter:description","content":"Migration of API endpoints to Cloudflare workers, more sophisticated cache management, Google Trends chart fixes and more..."}],["meta",{"property":"og:image","content":"https://moiva.io/images/moiva-head.jpg"}],["meta",{"name":"twitter:image","content":"https://moiva.io/images/moiva-head.jpg"}],["meta",{"property":"og:url","content":"https://moiva.io/blog/2021-03-update-migration-to-cloudflare-workers/"}],["meta",{"property":"twitter:url","content":"https://moiva.io/blog/2021-03-update-migration-to-cloudflare-workers/"}],["link",{"rel":"canonical","href":"https://moiva.io/blog/2021-03-update-migration-to-cloudflare-workers/"}],["script",{"async":true,"src":"https://platform.twitter.com/widgets.js","charset":"utf-8"}]]},"headers":[{"level":2,"title":"Migration to Cloudflare Workers","slug":"migration-to-cloudflare-workers"},{"level":2,"title":"Google Trends Chart fix","slug":"google-trends-chart-fix"},{"level":2,"title":"Most popular tweet so far","slug":"most-popular-tweet-so-far"},{"level":2,"title":"Google Search results do better","slug":"google-search-results-do-better"},{"level":2,"title":"Last but not least","slug":"last-but-not-least"}],"relativePath":"2021-03-update-migration-to-cloudflare-workers/index.md"}',d={},h=e('<p>Hey folks, Alexey is here.</p><p>Here is what I&#39;ve been busy with lately.</p><h2 id="migration-to-cloudflare-workers" tabindex="-1">Migration to Cloudflare Workers <a class="header-anchor" href="#migration-to-cloudflare-workers" aria-hidden="true">#</a></h2><p><a href="https://vercel.com/" target="_blank" rel="noopener noreferrer">Vercel</a> and its serverless functions allowed to quickly bootstrap and develop Moiva. And I&#39;m thankful to the developers at Vercel for that, they do really great job!</p><p>Having said that, the more mature Moiva becomes, the more requirements it has and the more limitations of Vercel&#39;s platform it hits.</p><p>One of the limitations was Moiva&#39;s requirements to serverless functions. It needed more visibility, more efficiency, more sophisticated debugging capabilities, more advanced features.</p><p>One time I came across <a href="https://workers.cloudflare.com/" target="_blank" rel="noopener noreferrer">Cloudflare Workers</a> and it caught my attention, it looked pretty attractive and seemed a mature and sophisticated solution for serverless functions.</p><p>After a bit of analysis, I quickly realized that it&#39;s the thing I needed.</p><p>So I set out to migrate all the api endpoints to Cloudflare Workers. I also implemented more sophisticated cache management tailored to each api endpoint. It took several evenings and mornings to finish it.</p><p>I believe such changes should improve Moiva&#39;s efficiency and it will become more noticeable once more users start using it and the Cache starts working to the full.</p><h2 id="google-trends-chart-fix" tabindex="-1">Google Trends Chart fix <a class="header-anchor" href="#google-trends-chart-fix" aria-hidden="true">#</a></h2><p>When I was doing the major refactoring of Moiva in January-February, I accidentally changed the way Google Trends Chart works - it lost optimization tricks I implemented before. That led to more requests being issued to get data for the chart. As a result, Google blocked Moiva completely and the chart stopped working, most probably it was blocked by the IP address.</p><p><img src="'+i+'" alt=""></p><p>I think Google Chart is one of the major metrics in evaluating popularity and I couldn&#39;t afford losing such a metric so easily.</p><p>My first idea was that the planned migration to Cloudflare workers + requests optimization + more advanced caching should fix the problem. But I soon realized that the <a href="https://github.com/pat310/google-trends-api" target="_blank" rel="noopener noreferrer">npm package</a> that I use to communicate with Google Trends can&#39;t be used with Cloudflare Workers. Simply because Cloudflare Workers don&#39;t run NodeJS runtime environment which is required for the package to work.</p><p>That means that I still had to rely on Vercel&#39;s serverless functions which run from the same IP-addresses. After looking into Vercel&#39;s documentation for serverless functions I learned that all Vercel&#39;s functions are executed in the same single region, meaning they probably have the same IP-address. I also learned that recently Vercel changed the default region for serverless functions and now allows existing free developer accounts to do a one-time change of the region. That was exactly what I needed because with the region change comes the change of the IP-addresses.</p><p>I hope the current implementation and cache settings won&#39;t make any trouble to Google and Moiva will continue to provide the valuable data.</p><h2 id="most-popular-tweet-so-far" tabindex="-1">Most popular tweet so far <a class="header-anchor" href="#most-popular-tweet-so-far" aria-hidden="true">#</a></h2><p>While working on Moiva I noticed that <a href="https://preactjs.com/" target="_blank" rel="noopener noreferrer">Preact</a> has a sharp increase in Npm downloads. I made a tweet about it wondering about the reason for that.</p>',19),c=e('<p>The tweet turned to be quite popular with 20k impressions. It was my most popular tweet so far and it even beat all my monthly tweet impressions.</p><h2 id="google-search-results-do-better" tabindex="-1">Google Search results do better <a class="header-anchor" href="#google-search-results-do-better" aria-hidden="true">#</a></h2><p>In Google Search results Moiva didn&#39;t perform well for a while and it concerned me. I did many improvements but nothing really was changing and Google didn&#39;t want to digest my sitemap. Fortunately, the results of the last month bring some hope.</p><p><img src="'+l+'" alt=""></p><h2 id="last-but-not-least" tabindex="-1">Last but not least <a class="header-anchor" href="#last-but-not-least" aria-hidden="true">#</a></h2><p>Moiva was featured in the <a href="https://makerwork.substack.com/p/makerwork006" target="_blank" rel="noopener noreferrer">Makerwork</a> newsletter.</p>',6);function p(m,g,u,f,w,b){const t=a("Tweet");return r(),s("div",null,[h,n(t,{id:"_aantipov/status/1367183314256281603"}),c])}var _=o(d,[["render",p]]);export{k as __pageData,_ as default};
